<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <div class="loader-container" id="loader">
        <div class="loader"></div>
    </div>

    <div class="page f-page login hidden" id="login">
        <div class="f-form">
            <h1>Log In</h1>
            <div class="login-input-box input-box">
                <label class="login-label f-label" for="login-email">E-mail</label>
                <input class="f-input" type="email" name="login-email" id="login-email">
            </div>
            <div class="login-input-box input-box">
                <label class="login-label f-label" for="login-password">Password</label>
                <input class="f-input" type="password" name="login-password" id="login-password">
            </div>
            <a class="f-switch-btn-to-signup" href="#">Don't have an account? Sign Up</a>
            <button class="login-btn f-button" type="submit">Log In</button>
            <a class="f-forgot-pass" href="#" id="forgot-password-link">Forgot password?</a>
            <div id="login-error" class="error-message hidden"></div>
        </div>
    </div>

    <div class="page f-page signup" id="signup">
        <form class="signup-form f-form" action="#">
            <h1>Sign Up</h1>
            <div class="login-input-box input-box">
                <label class="login-label f-label" for="e-mail">E-mail</label>
                <input class="f-input" type="email" name="e-mail" id="e-mail">
            </div>
            <div class="login-input-box input-box">
                <label class="login-label f-label" for="password">Password</label>
                <input class="f-input" type="password" name="password" id="password">
            </div>
            <div class="login-input-box input-box">
                <label class="login-label f-label" for="re-password">Repeat Password</label>
                <input class="f-input" type="password" name="re-password" id="re-password">
            </div>
            <a class="f-switch-btn-to-login" href="#">Already have an account?</a>
            <button class="sign-up f-button" type="submit">Sign Up</button>
            <div id="signup-error" class="error-message hidden"></div>
        </form>
    </div>

    <div id="forgot-pass-div" class="page forgot-pass hidden f-form">
        <button onclick="backToLogin()" class="f-pass-exit-btn">
            <?xml version="1.0" encoding="UTF-8"?><svg width="24px" height="24px" viewBox="0 0 24 24" stroke-width="1.5"
                fill="none" xmlns="http://www.w3.org/2000/svg" color="#3b742f">
                <path d="M21 12L3 12M3 12L11.5 3.5M3 12L11.5 20.5" stroke="#3b742f" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
        <h1>Şifrəni Yeniləyin</h1>
        <div class="login-input-box input-box">
            <label class="login-label f-label" for="forgot-email">E-mail</label>
            <input class="f-input" type="email" id="forgot-email">
        </div>
        <button class="reset-pass-btn f-button" type="submit">Reset Password</button>
    </div>

    <div class="alert-box">
        <div class="alert login-success">
            Logged-in successfully!
        </div>
        <div class="alert signup-success">
            Account created!
        </div>
        <div class="alert password-reset-send-success">
            Password reset link has been sent to your email address.
        </div>
        <div class="alert signup-error hidden">Xəta baş verdi!</div>
        <div class="alert login-error hidden">Xəta baş verdi!</div>
        <div id="reset-error" class="alert hidden"></div>
    </div>

    <div id="authorization-error" style="display: none;">
        <?xml version="1.0" encoding="UTF-8"?><svg width="72px" height="72px" viewBox="0 0 24 24" stroke-width="1.5"
            fill="none" xmlns="http://www.w3.org/2000/svg" color="#fff">
            <path d="M15 21H4C2.89543 21 2 20.1046 2 19V5C2 3.89543 2.89543 3 4 3H20C21.1046 3 22 3.89543 22 5V15"
                stroke="#fff" stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M2 7L22 7" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            </path>
            <path d="M5 5.01L5.01 4.99889" stroke="#fff" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path d="M8 5.01L8.01 4.99889" stroke="#fff" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path d="M11 5.01L11.01 4.99889" stroke="#fff" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round"></path>
            <path
                d="M18 22.2426L20.1213 20.1213M20.1213 20.1213L22.2426 18M20.1213 20.1213L18 18M20.1213 20.1213L22.2426 22.2426"
                stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>
        İcazə xətası baş verdi! Zəhmət olmasa, administratorla əlaqə saxlayın.
        <a class="error-contact" href="#">Contact</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyACMunaPmYKXnphdouIc6T8fDTJHfL8Q1Q",
            authDomain: "ecommerce-thefeerid.firebaseapp.com",
            projectId: "ecommerce-thefeerid",
            storageBucket: "ecommerce-thefeerid.appspot.com",
            messagingSenderId: "340163398169",
            appId: "1:340163398169:web:a2ba8e0e8f2557dd4f3888",
            measurementId: "G-2Q0G4FHG5T"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);
        const loader = document.getElementById('loader');

        document.querySelector('.signup-form').addEventListener('submit', function (event) {
            event.preventDefault();
            loader.style.display = 'flex';

            const email = document.getElementById('e-mail').value;
            const password = document.getElementById('password').value;
            const rePassword = document.getElementById('re-password').value;

            if (password !== rePassword) {
                showAlert('signup-error', 'Şifrələr uyğun gəlmir!');
                loader.style.display = 'none';
                return;
            }

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const userId = userCredential.user.uid;
                    set(ref(database, 'users/' + userId), {
                        email: email,
                    }).then(() => {
                        showAlert('signup-success', 'Məlumatlar uğurla göndərildi!');
                        loader.style.display = 'none';
                        window.location.href = "assets/pages/main.html";
                    });
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    showAlert('signup-error', "Xəta baş verdi. Zəhmət olmasa məlumatlarınızı yoxlayın.");
                    console.error("Xəta baş verdi: ", errorMessage);
                    loader.style.display = 'none';
                    if (errorMessage.includes("Firebase: Error (auth/")) {
                        document.getElementById('authorization-error').style.display = 'flex';
                        loader.style.display = 'none';
                        return;
                    }
                });
        });

        document.querySelector('.login-btn').addEventListener('click', function (event) {
            event.preventDefault();
            loader.style.display = 'flex';

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    console.log('Giriş uğurlu:', user);
                    showAlert('login-success', 'Giriş uğurlu!');
                    loader.style.display = 'none';
                    window.location.href = "assets/pages/main.html";
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    showAlert('login-error', "Xəta baş verdi.");
                    console.error("Xəta baş verdi: ", errorMessage);
                    loader.style.display = 'none';
                });
        });

        document.querySelector('.f-forgot-pass').addEventListener('click', function (event) {
            event.preventDefault();
            document.getElementById('forgot-pass-div').classList.remove('hidden');
            document.getElementById('login').classList.add('hidden');
            document.getElementById('signup').classList.add('hidden');
        });

        document.querySelector('.reset-pass-btn').addEventListener('click', function (event) {
            event.preventDefault();
            const email = document.getElementById('forgot-email').value;
            const loader = document.getElementById('loader');
            loader.style.display = 'flex';

            sendPasswordResetEmail(auth, email)
                .then(() => {
                    showAlert('password-reset-send-success');
                    loader.style.display = 'none';
                })
                .catch((error) => {
                    document.getElementById('reset-error').innerText = "E-mail tapılmadı və ya başqa xəta baş verdi.";
                    document.getElementById('reset-error').classList.remove('hidden');
                    loader.style.display = 'none';
                    console.error(error.message);
                });
        });

        function showAlert(alertClass) {
            const alert = document.querySelector(`.${alertClass}`);
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 2000);
        }

        const loginDiv = document.querySelector('.login');
        const signupDiv = document.querySelector('.signup');
        const forgotPassDiv = document.querySelector('.forgot-pass')

        document.querySelector('.f-switch-btn-to-login').addEventListener('click', function (event) {
            event.preventDefault();
            signupDiv.classList.add('hidden');
            loginDiv.classList.remove('hidden');
        });

        document.querySelector('.f-switch-btn-to-signup').addEventListener('click', function (event) {
            event.preventDefault();
            loginDiv.classList.add('hidden');
            signupDiv.classList.remove('hidden');
        });

        const inputFields = document.querySelectorAll('.f-input');
        inputFields.forEach(inputField => {
            inputField.addEventListener('input', function () {
                if (inputField.value.trim() !== "") {
                    inputField.classList.add('filled');
                } else {
                    inputField.classList.remove('filled');
                }
            });
        });
    </script>

    <script>
        function backToLogin() {
            const signupDiv = document.getElementById('signup');
            const loginDiv = document.getElementById('login');
            const forgotPassDiv = document.getElementById('forgot-pass-div');

            forgotPassDiv.classList.add('hidden');
            signupDiv.classList.add('hidden');
            loginDiv.classList.remove('hidden');
        }
    </script>
</body>

</html>